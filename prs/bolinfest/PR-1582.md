# PR #1582: Auto format code on save and add more details to AGENTS.md

- URL: https://github.com/openai/codex/pull/1582
- Author: pakrym-oai
- Created: 2025-07-15 14:37:35 UTC
- Updated: 2025-07-17 18:40:09 UTC
- Changes: +43/-2, Files changed: 7, Commits: 7

## Description

Adds a default vscode config with generally applicable settings.
Adds makefile with some entrypoints for environment setup and to help agents better verify changes.

## Full Diff

```diff
diff --git a/.vscode/launch.json b/.vscode/launch.json
new file mode 100644
index 0000000000..618207f301
--- /dev/null
+++ b/.vscode/launch.json
@@ -0,0 +1,18 @@
+{
+    "version": "0.2.0",
+    "configurations": [
+        {
+            "type": "lldb",
+            "request": "launch",
+            "name": "Cargo launch",
+            "cargo": {
+                "cwd": "${workspaceFolder}/codex-rs",
+                "args": [
+                    "build",
+                    "--bin=codex-tui"
+                ]
+            },
+            "args": []
+        }
+    ]
+}
diff --git a/.vscode/settings.json b/.vscode/settings.json
new file mode 100644
index 0000000000..f66a12583c
--- /dev/null
+++ b/.vscode/settings.json
@@ -0,0 +1,10 @@
+{
+    "rust-analyzer.checkOnSave": true,
+    "rust-analyzer.check.command": "clippy",
+    "rust-analyzer.check.extraArgs": ["--all-features", "--tests"],
+    "rust-analyzer.rustfmt.extraArgs": ["--config", "imports_granularity=Item"],
+    "[rust]": {
+        "editor.defaultFormatter": "rust-lang.rust-analyzer",
+        "editor.formatOnSave": true,
+    }
+}
diff --git a/AGENTS.md b/AGENTS.md
index 1348e57824..4188cc9873 100644
--- a/AGENTS.md
+++ b/AGENTS.md
@@ -3,3 +3,7 @@
 In the codex-rs folder where the rust code lives:
 
 - Never add or modify any code related to `CODEX_SANDBOX_NETWORK_DISABLED_ENV_VAR`. You operate in a sandbox where `CODEX_SANDBOX_NETWORK_DISABLED=1` will be set whenever you use the `shell` tool. Any existing code that uses `CODEX_SANDBOX_NETWORK_DISABLED_ENV_VAR` was authored with this fact in mind. It is often used to early exit out of tests that the author knew you would not be able to run given your sandbox limitations.
+
+After making changes to the rust code run `just fmt` (in `codex-rs` directory) to format the code and `just fix` (in `codex-rs` directory) to fix any linter issues in the code.
+
+Ensure the test suite passes by running `cargo test --all-features` in the `codex-rs` directory.
diff --git a/codex-rs/justfile b/codex-rs/justfile
index 83a390ec56..6c8e9f9e4d 100644
--- a/codex-rs/justfile
+++ b/codex-rs/justfile
@@ -23,3 +23,9 @@ file-search *args:
 # format code
 fmt:
     cargo fmt -- --config imports_granularity=Item
+
+fix:
+    cargo clippy --fix --all-features --tests --allow-dirty
+
+install:
+    cargo fetch
diff --git a/codex-rs/toolchain.toml b/codex-rs/toolchain.toml
new file mode 100644
index 0000000000..72bafdf4b6
--- /dev/null
+++ b/codex-rs/toolchain.toml
@@ -0,0 +1,3 @@
+[toolchain]
+channel = "1.88.0"
+components = [ "clippy", "rustfmt", "rust-src"]
diff --git a/codex-rs/tui/src/app.rs b/codex-rs/tui/src/app.rs
index e1dde8332d..0cf2b3538a 100644
--- a/codex-rs/tui/src/app.rs
+++ b/codex-rs/tui/src/app.rs
@@ -60,7 +60,7 @@ struct ChatWidgetArgs {
     initial_images: Vec<PathBuf>,
 }
 
-impl<'a> App<'a> {
+impl App<'_> {
     pub(crate) fn new(
         config: Config,
         initial_prompt: Option<String>,
diff --git a/codex-rs/tui/src/bottom_pane/status_indicator_view.rs b/codex-rs/tui/src/bottom_pane/status_indicator_view.rs
index d9ac57d7b9..de46ac2709 100644
--- a/codex-rs/tui/src/bottom_pane/status_indicator_view.rs
+++ b/codex-rs/tui/src/bottom_pane/status_indicator_view.rs
@@ -24,7 +24,7 @@ impl StatusIndicatorView {
     }
 }
 
-impl<'a> BottomPaneView<'a> for StatusIndicatorView {
+impl BottomPaneView<'_> for StatusIndicatorView {
     fn update_status_text(&mut self, text: String) -> ConditionalUpdate {
         self.update_text(text);
         ConditionalUpdate::NeedsRedraw
```

## Review Comments

### .vscode/settings.json

- Created: 2025-07-17 18:22:23 UTC | Link: https://github.com/openai/codex/pull/1582#discussion_r2214005370

```diff
@@ -0,0 +1,11 @@
+{
+    "rust-analyzer.checkOnSave": true,
+    "rust-analyzer.check.command": "clippy",
+    "rust-analyzer.check.extraArgs": ["--all-features", "--tests"],
```

> Please also add:
> 
> ```json
> "rust-analyzer.rustfmt.extraArgs": ["--config", "imports_granularity=Item"],
> ```

- Created: 2025-07-17 18:23:33 UTC | Link: https://github.com/openai/codex/pull/1582#discussion_r2214007185

```diff
@@ -0,0 +1,11 @@
+{
+    "rust-analyzer.checkOnSave": true,
+    "rust-analyzer.check.command": "clippy",
+    "rust-analyzer.check.extraArgs": ["--all-features", "--tests"],
+  
+    "[rust]": {
+        "editor.defaultFormatter": "rust-lang.rust-analyzer",
+        "editor.formatOnSave": true,
+    }
+}
+
```

> add newline at eof?

### AGENTS.md

- Created: 2025-07-17 18:25:08 UTC | Link: https://github.com/openai/codex/pull/1582#discussion_r2214011079

```diff
@@ -3,3 +3,7 @@
 In the codex-rs folder where the rust code lives:
 
 - Never add or modify any code related to `CODEX_SANDBOX_NETWORK_DISABLED_ENV_VAR`. You operate in a sandbox where `CODEX_SANDBOX_NETWORK_DISABLED=1` will be set whenever you use the `shell` tool. Any existing code that uses `CODEX_SANDBOX_NETWORK_DISABLED_ENV_VAR` was authored with this fact in mind. It is often used to early exit out of tests that the author knew you would not be able to run given your sandbox limitations.
+
+After making changes to the rust code run `make format` to format the code and `make fix` to fix the code.
```

> I know everyone has their favorite tool, but can we stick with the `codex-rs/justfile`?
> 
> I admit that `make` is more commonly available than `just`, but it feels a bit weird to have both?
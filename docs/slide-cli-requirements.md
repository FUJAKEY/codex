# Slide CLI 要件定義（MVP）

## 概要 / 目的
- 端末（ターミナル）で実行する最小構成のエージェント型 CLI「Slide」を提供する。
- `slide` コマンドで起動し、会話（チャット）から Markdown スライド（.md）を生成する。
- 初回挙動は既存 Codex CLI に近い UX とし、安全なサンドボックス実行・承認フローを踏襲する（同等で十分）。
- 生成された Markdown をユーザーが任意ツールで PPTX 化することを前提（本MVPでは変換機能は非対象）。

## スコープ（MVP）
- `slide` コマンドの提供（Node 薄いラッパ or 既存 Rust バイナリ起動の別名）。
- 対話（チャット）からスライド要件を受け取り、Markdown ファイルを生成。
- 出力先はリポジトリ直下の `slides/` ディレクトリ（無ければ作成）。
- 承認ポリシー（suggest/auto-edit/full-auto）およびサンドボックス方針は Codex と同等。
- 既存のモデル・プロバイダ設定は流用（モデル選定はデフォルト `o4-mini` 想定）。

## 非スコープ（MVP）
- PPTX/PDF への自動変換（将来対応）。
- 画像生成・テーマ選択 UI、プレビュー TUI。
- 外部 MCP 連携（MVPでは必須ではない）。

## ユースケース例
- 「営業向け 10 枚の提案資料を作って」→ 章立て・要点・箇条書きで Markdown 生成。
- 「この仕様書から要約スライド 5 枚」→ 指定ファイルを読み要約して Markdown 生成。
- 「日本語/英語で作って」→ 言語指定で出力。

## CLI 仕様（MVP）
- コマンド名: `slide`
- 動作モード:
  - `slide`（インタラクティブ REPL）
  - `slide "<プロンプト>"`（ワンショット開始）
- 主なフラグ（Codex と共通に揃える）
  - `-a, --approval-mode <suggest|auto-edit|full-auto>`
  - `-m, --model <name>`
  - `-q, --quiet`、`--json`（必要に応じて）
- ファイル生成アクションは承認プロンプトを経由（auto-edit/full-auto では自動）。

## 生成物仕様（Markdown）
- 出力先: `slides/<timestamp>_<slug>.md`
- 推奨フォーマット:
  - 1行目: タイトル（`# タイトル`）
  - スライドは `##` 区切り（1スライド=1セクション）
  - 箇条書き・コード・画像プレースホルダを許容（画像はURL/相対パス）
- 例:
  ```md
  # プロジェクト提案 2025Q1

  ## 1. 課題
  - 現状の問題点
  - 影響範囲

  ## 2. 解決方針
  - 施策A
  - 施策B
  ```

## 初回起動時の挙動
- Codex 同等のオンボーディング（モデル・承認モード・通知など）を簡易にガイド。
- 必要最小限の設定ファイル（`~/.slide/config.(json|yaml)` or 既存 `~/.codex/config.*` を流用）
  - MVPでは Codex の設定ファイルを流用し、`provider/model/approvalMode` を尊重。

## セキュリティ / 実行方針
- Codex と同様にネットワーク無効（Full Auto時も既定は無効）・作業ディレクトリ内に限定。
- Linux ではコンテナ/iptables によるサンドボックスを利用可能（将来互換）。
- ファイル書き込みは承認制（モード依存）。

## ログ / トレース
- `RUST_LOG` / `DEBUG` など既存と同等の出力を踏襲。
- 生成結果（パス）を確実にユーザーへ表示。

## 実装方針（MVP 最短）
1) CLI ラッパ（Node）
   - `slide-cli/` を `codex-cli/` と同構成で作成し、`bin/slide.js` を追加。
   - プラットフォーム判定 → `bin/slide-<target>` を起動（codex と同形式）。
   - 互換最優先のため、Rust 側に `--app slide` などのモードを伝える（環境変数でも可）。

2) Rust 側（codex-rs/cli）
   - `argv0` もしくは `--app slide` で「Slideモード」を有効化。
   - デフォルトのカスタム指示（スライド出力を志向）を適用。
   - ファイル生成アクションのユーティリティ（`slides/` 作成・ファイル命名・上書き確認）。

3) 最小チャット体験
   - REPLで「スライドテーマ/枚数/対象読者/口調/画像有無」等を引き出す簡易プロンプト。
   - 1回目の下書きMDを生成 → 承認 → `slides/` に保存。
   - 再生成/追記/分割などは将来拡張。

## 受け入れ基準（MVP）
- `slide "営業向け提案 10枚 日本語で"` で `slides/*.md` が生成される。
- インタラクティブで追記指示を出すと、上記ファイルに安全に追記（または別名保存）できる。
- suggest/auto-edit/full-auto の各モードで意図どおりに承認フローが機能。

## テスト方針（最小）
- 単体: ファイル命名・スラッグ生成・出力ディレクトリ作成のテスト。
- 統合: 固定プロンプトで Markdown を生成し、想定のヘッダ/セクション数を満たすか検証。

## 今後の拡張
- 画像生成（ダイアグラム/サムネイル）・テーマ（色/フォント）・テンプレート対応。
- PPTX/PDF 自動変換（Pandoc/Marp 等連携の検討）。
- 外部 MCP の利用（社内ナレッジ検索、図表自動作成ツールなど）。

## 未決事項 / 要確認
- パッケージ名（npm）: 仮 `@yourorg/slide`（要確定）。
- 設定ファイル: `~/.slide/*` 新設か `~/.codex/*` 流用か（MVPは流用案）。
- リリース戦略: codex と同一トリプル/同梱方式で問題ないか。

## 想定ディレクトリ構造（MVP）
```
repo-root/
├─ codex-cli/                # 既存: Codex 用 Node ランチャ
│  └─ ...
├─ codex-rs/                 # 既存: Rust ワークスペース
│  ├─ cli/                   # 既存: Rust CLI 本体
│  ├─ core/                  # 既存: コア機能
│  ├─ ...
│  └─ (他の既存クレート)
├─ slide-cli/                # 新規: Slide 用 Node ランチャ（codex-cli と同構成）
│  ├─ package.json
│  ├─ bin/
│  │  └─ slide.js           # エントリポイント（プラットフォーム判定→ slide-<target> 実行）
│  ├─ scripts/               # （必要なら）リリース・サンドボックス補助
│  └─ (bin/slide-<target> はリリース時に同梱)
├─ docs/
│  ├─ slide-cli-requirements.md
│  └─ ...
├─ slides/                   # 生成物（Markdown）出力先（初回生成時に作成）
│  └─ <timestamp>_<slug>.md
└─ ...
```

- Node ランチャを分ける理由: コマンド名 `slide` を npm 経由で配布しやすくするため（`codex` と並存）。
- Rust 側は既存 CLI にモード追加（`--app slide` or argv0）で最小改修方針。
- 将来、共通化できる箇所（スクリプト・配布手順）は `codex-cli` と揃える。
